import React, { useState, useCallback, useEffect } from "react"
import { Navbar, Container, Nav, NavDropdown } from "react-bootstrap"
import { useSession, signOut } from "next-auth/react"
import Link from "next/link"

export default function LandingNavigation({ location }) {
    const { data: session, status } = useSession()
    const [scroll, setScroll] = useState(1)
    const [buttonActive, setButtonActive] = useState(null)

    const toggle = useCallback(() => setButtonActive(!buttonActive))

    useEffect(() => {
        let isMounted = true
        const animateNavigation = () => {
            if (isMounted) {
                document.addEventListener("scroll", () => {
                    const scrollCheck = window.scrollY < 1
                    if (scrollCheck !== scroll) {
                        setScroll(scrollCheck)
                    }
                })
            }
        }
        animateNavigation()

        return () => {
            isMounted = false
            animateNavigation()
        }
    }, [])

    return (
        <div className="pai-landing-nav">
            <Navbar fixed="top" collapseOnSelect expand="lg" bg="dark" variant="dark" className={scroll == !1 ? "navigation scrolling" : "navigation"}>
                <Container>
                    <Navbar.Brand className="brand" href="/">
                        <svg viewBox="0 0 820 199" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M303.311 86.208C303.311 89.9493 302.452 93.384 300.735 96.512C299.017 99.5787 296.38 102.063 292.823 103.964C289.265 105.865 284.849 106.816 279.575 106.816H269.823V130H254.091V65.416H279.575C284.727 65.416 289.081 66.3053 292.639 68.084C296.196 69.8627 298.864 72.316 300.643 75.444C302.421 78.572 303.311 82.16 303.311 86.208ZM278.379 94.304C281.384 94.304 283.623 93.5987 285.095 92.188C286.567 90.7773 287.303 88.784 287.303 86.208C287.303 83.632 286.567 81.6387 285.095 80.228C283.623 78.8173 281.384 78.112 278.379 78.112H269.823V94.304H278.379ZM334.869 130.736C329.84 130.736 325.301 129.663 321.253 127.516C317.266 125.369 314.108 122.303 311.777 118.316C309.508 114.329 308.373 109.668 308.373 104.332C308.373 99.0573 309.538 94.4267 311.869 90.44C314.2 86.392 317.389 83.2947 321.437 81.148C325.485 79.0013 330.024 77.928 335.053 77.928C340.082 77.928 344.621 79.0013 348.669 81.148C352.717 83.2947 355.906 86.392 358.237 90.44C360.568 94.4267 361.733 99.0573 361.733 104.332C361.733 109.607 360.537 114.268 358.145 118.316C355.814 122.303 352.594 125.369 348.485 127.516C344.437 129.663 339.898 130.736 334.869 130.736ZM334.869 117.12C337.874 117.12 340.42 116.016 342.505 113.808C344.652 111.6 345.725 108.441 345.725 104.332C345.725 100.223 344.682 97.064 342.597 94.856C340.573 92.648 338.058 91.544 335.053 91.544C331.986 91.544 329.441 92.648 327.417 94.856C325.393 97.0027 324.381 100.161 324.381 104.332C324.381 108.441 325.362 111.6 327.325 113.808C329.349 116.016 331.864 117.12 334.869 117.12ZM390.963 130.736C386.486 130.736 382.499 129.969 379.003 128.436C375.507 126.903 372.747 124.817 370.723 122.18C368.699 119.481 367.564 116.476 367.319 113.164H382.867C383.051 114.943 383.879 116.384 385.351 117.488C386.823 118.592 388.632 119.144 390.779 119.144C392.742 119.144 394.244 118.776 395.287 118.04C396.391 117.243 396.943 116.231 396.943 115.004C396.943 113.532 396.176 112.459 394.643 111.784C393.11 111.048 390.626 110.251 387.191 109.392C383.511 108.533 380.444 107.644 377.991 106.724C375.538 105.743 373.422 104.24 371.643 102.216C369.864 100.131 368.975 97.34 368.975 93.844C368.975 90.9 369.772 88.232 371.367 85.84C373.023 83.3867 375.415 81.4547 378.543 80.044C381.732 78.6333 385.504 77.928 389.859 77.928C396.299 77.928 401.359 79.5227 405.039 82.712C408.78 85.9013 410.927 90.1333 411.479 95.408H396.943C396.698 93.6293 395.9 92.2187 394.551 91.176C393.263 90.1333 391.546 89.612 389.399 89.612C387.559 89.612 386.148 89.98 385.167 90.716C384.186 91.3907 383.695 92.3413 383.695 93.568C383.695 95.04 384.462 96.144 385.995 96.88C387.59 97.616 390.043 98.352 393.355 99.088C397.158 100.069 400.255 101.051 402.647 102.032C405.039 102.952 407.124 104.485 408.903 106.632C410.743 108.717 411.694 111.539 411.755 115.096C411.755 118.101 410.896 120.8 409.179 123.192C407.523 125.523 405.1 127.363 401.911 128.712C398.783 130.061 395.134 130.736 390.963 130.736ZM449.992 116.66V130H441.988C436.284 130 431.837 128.62 428.648 125.86C425.458 123.039 423.864 118.469 423.864 112.152V91.728H417.608V78.664H423.864V66.152H439.596V78.664H449.9V91.728H439.596V112.336C439.596 113.869 439.964 114.973 440.7 115.648C441.436 116.323 442.662 116.66 444.38 116.66H449.992ZM474.487 87.22C476.327 84.3987 478.627 82.1907 481.387 80.596C484.147 78.94 487.213 78.112 490.587 78.112V94.764H486.263C482.337 94.764 479.393 95.6227 477.431 97.34C475.468 98.996 474.487 101.94 474.487 106.172V130H458.755V78.664H474.487V87.22ZM494.978 104.24C494.978 98.9653 495.96 94.3347 497.922 90.348C499.946 86.3613 502.676 83.2947 506.11 81.148C509.545 79.0013 513.378 77.928 517.61 77.928C521.229 77.928 524.388 78.664 527.086 80.136C529.846 81.608 531.962 83.54 533.434 85.932V78.664H549.166V130H533.434V122.732C531.901 125.124 529.754 127.056 526.994 128.528C524.296 130 521.137 130.736 517.518 130.736C513.348 130.736 509.545 129.663 506.11 127.516C502.676 125.308 499.946 122.211 497.922 118.224C495.96 114.176 494.978 109.515 494.978 104.24ZM533.434 104.332C533.434 100.407 532.33 97.3093 530.122 95.04C527.976 92.7707 525.338 91.636 522.21 91.636C519.082 91.636 516.414 92.7707 514.206 95.04C512.06 97.248 510.986 100.315 510.986 104.24C510.986 108.165 512.06 111.293 514.206 113.624C516.414 115.893 519.082 117.028 522.21 117.028C525.338 117.028 527.976 115.893 530.122 113.624C532.33 111.355 533.434 108.257 533.434 104.332ZM568.46 73.328C565.7 73.328 563.43 72.5307 561.652 70.936C559.934 69.28 559.076 67.256 559.076 64.864C559.076 62.4107 559.934 60.3867 561.652 58.792C563.43 57.136 565.7 56.308 568.46 56.308C571.158 56.308 573.366 57.136 575.084 58.792C576.862 60.3867 577.752 62.4107 577.752 64.864C577.752 67.256 576.862 69.28 575.084 70.936C573.366 72.5307 571.158 73.328 568.46 73.328ZM576.28 78.664V130H560.548V78.664H576.28ZM595.041 130.736C592.281 130.736 590.011 129.939 588.233 128.344C586.515 126.688 585.657 124.664 585.657 122.272C585.657 119.819 586.515 117.764 588.233 116.108C590.011 114.452 592.281 113.624 595.041 113.624C597.739 113.624 599.947 114.452 601.665 116.108C603.443 117.764 604.333 119.819 604.333 122.272C604.333 124.664 603.443 126.688 601.665 128.344C599.947 129.939 597.739 130.736 595.041 130.736ZM610.517 104.332C610.517 98.996 611.591 94.3347 613.737 90.348C615.945 86.3613 618.981 83.2947 622.845 81.148C626.771 79.0013 631.248 77.928 636.277 77.928C642.717 77.928 648.084 79.6147 652.377 82.988C656.732 86.3613 659.584 91.1147 660.933 97.248H644.189C642.779 93.3227 640.049 91.36 636.001 91.36C633.119 91.36 630.819 92.4947 629.101 94.764C627.384 96.972 626.525 100.161 626.525 104.332C626.525 108.503 627.384 111.723 629.101 113.992C630.819 116.2 633.119 117.304 636.001 117.304C640.049 117.304 642.779 115.341 644.189 111.416H660.933C659.584 117.427 656.732 122.149 652.377 125.584C648.023 129.019 642.656 130.736 636.277 130.736C631.248 130.736 626.771 129.663 622.845 127.516C618.981 125.369 615.945 122.303 613.737 118.316C611.591 114.329 610.517 109.668 610.517 104.332ZM692.717 130.736C687.687 130.736 683.149 129.663 679.101 127.516C675.114 125.369 671.955 122.303 669.625 118.316C667.355 114.329 666.221 109.668 666.221 104.332C666.221 99.0573 667.386 94.4267 669.717 90.44C672.047 86.392 675.237 83.2947 679.285 81.148C683.333 79.0013 687.871 77.928 692.901 77.928C697.93 77.928 702.469 79.0013 706.517 81.148C710.565 83.2947 713.754 86.392 716.085 90.44C718.415 94.4267 719.581 99.0573 719.581 104.332C719.581 109.607 718.385 114.268 715.993 118.316C713.662 122.303 710.442 125.369 706.333 127.516C702.285 129.663 697.746 130.736 692.717 130.736ZM692.717 117.12C695.722 117.12 698.267 116.016 700.353 113.808C702.499 111.6 703.573 108.441 703.573 104.332C703.573 100.223 702.53 97.064 700.445 94.856C698.421 92.648 695.906 91.544 692.901 91.544C689.834 91.544 687.289 92.648 685.265 94.856C683.241 97.0027 682.229 100.161 682.229 104.332C682.229 108.441 683.21 111.6 685.173 113.808C687.197 116.016 689.711 117.12 692.717 117.12ZM793.431 78.112C799.809 78.112 804.869 80.044 808.611 83.908C812.413 87.772 814.315 93.1387 814.315 100.008V130H798.675V102.124C798.675 98.812 797.785 96.2667 796.007 94.488C794.289 92.648 791.897 91.728 788.831 91.728C785.764 91.728 783.341 92.648 781.563 94.488C779.845 96.2667 778.987 98.812 778.987 102.124V130H763.347V102.124C763.347 98.812 762.457 96.2667 760.679 94.488C758.961 92.648 756.569 91.728 753.503 91.728C750.436 91.728 748.013 92.648 746.235 94.488C744.517 96.2667 743.659 98.812 743.659 102.124V130H727.927V78.664H743.659V85.104C745.253 82.9573 747.339 81.2707 749.915 80.044C752.491 78.756 755.404 78.112 758.655 78.112C762.519 78.112 765.953 78.94 768.959 80.596C772.025 82.252 774.417 84.6133 776.135 87.68C777.913 84.8587 780.336 82.5587 783.403 80.78C786.469 79.0013 789.812 78.112 793.431 78.112Z"
                                fill="#393D3F"
                            />
                            <path fillRule="evenodd" clipRule="evenodd" d="M0.445999 55.982L0 88.274L96.34 32.287L96.782 0L0.445999 55.982Z" fill="#6C63FF" />
                            <path fillRule="evenodd" clipRule="evenodd" d="M0.445999 110.54L0 142.832L96.34 86.848L96.782 54.556L0.445999 110.54Z" fill="#6C63FF" />
                            <path fillRule="evenodd" clipRule="evenodd" d="M97.408 166.528L96.977 198.814L193.304 142.832L193.746 110.54L97.408 166.528Z" fill="#6C63FF" />
                            <path fillRule="evenodd" clipRule="evenodd" d="M97.408 111.966L96.977 144.26L193.304 88.274L193.746 55.982L97.408 111.966Z" fill="#6C63FF" />
                            <path opacity="0.7" fillRule="evenodd" clipRule="evenodd" d="M0 88.274L96.977 144.26L97.408 111.966L0.445999 55.982L0 88.274Z" fill="#6C63FF" />
                            <path opacity="0.7" fillRule="evenodd" clipRule="evenodd" d="M96.34 32.287L193.304 88.274L193.746 55.982L96.782 0L96.34 32.287Z" fill="#6C63FF" />
                            <path opacity="0.7" fillRule="evenodd" clipRule="evenodd" d="M96.34 86.848L193.304 142.832L193.746 110.54L96.782 54.556L96.34 86.848Z" fill="#6C63FF" />
                            <path opacity="0.7" fillRule="evenodd" clipRule="evenodd" d="M0 142.832L96.977 198.814L97.408 166.528L0.445999 110.54L0 142.832Z" fill="#6C63FF" />
                        </svg>
                    </Navbar.Brand>
                    <Nav className="mx-auto links d-none d-xl-flex" activeKey="/home">
                        <Link href="/" passHref>
                            <Nav.Link eventKey="home">Home</Nav.Link>
                        </Link>
                        <Link href="/browse-images" passHref>
                            <Nav.Link eventKey="images">Images</Nav.Link>
                        </Link>
                        <Link href="/pricing" passHref>
                            <Nav.Link eventKey="pricing">Pricing</Nav.Link>
                        </Link>
                    </Nav>
                    {status === "authenticated" ? (
                        <Nav className="navigation-authenticated d-none d-xl-flex">
                            <NavDropdown id="user-dropdown" title={session.user.email} menuVariant="light" className="user-dropdown">
                                <NavDropdown.Item href="/dashboard">Dashboard</NavDropdown.Item>
                                <NavDropdown.Divider />
                                <NavDropdown.Item onClick={() => signOut()}>Log out</NavDropdown.Item>
                            </NavDropdown>
                            <div className="user-image">
                                <img src={`/api/image/profilePicture?userId=${session.user.id}&provider=${session.user.provider}`} alt="profile picture" />
                            </div>
                        </Nav>
                    ) : (
                        <Nav className="not-authentication d-none d-xl-flex">
                            <Nav.Link className="login-link" href="/login">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M10 1.66667C7.70254 1.66667 5.83337 3.53584 5.83337 5.83334V8.33334H5.00004C4.55801 8.33334 4.13409 8.50893 3.82153 8.82149C3.50897 9.13406 3.33337 9.55798 3.33337 10V16.6667C3.33337 17.1087 3.50897 17.5326 3.82153 17.8452C4.13409 18.1577 4.55801 18.3333 5.00004 18.3333H15C15.4421 18.3333 15.866 18.1577 16.1786 17.8452C16.4911 17.5326 16.6667 17.1087 16.6667 16.6667V10C16.6667 9.55798 16.4911 9.13406 16.1786 8.82149C15.866 8.50893 15.4421 8.33334 15 8.33334H14.1667V5.83334C14.1667 3.53584 12.2975 1.66667 10 1.66667ZM7.50004 5.83334C7.50004 4.45501 8.62171 3.33334 10 3.33334C11.3784 3.33334 12.5 4.45501 12.5 5.83334V8.33334H7.50004V5.83334ZM10.8334 14.7692V16.6667H9.16671V14.7692C8.87536 14.6023 8.64142 14.3511 8.49573 14.0486C8.35004 13.7462 8.29944 13.4066 8.35061 13.0748C8.40178 12.743 8.5523 12.4345 8.78234 12.1899C9.01238 11.9454 9.31114 11.7763 9.63921 11.705C9.88289 11.6511 10.1356 11.6526 10.3786 11.7094C10.6216 11.7662 10.8488 11.8768 11.0434 12.0331C11.2379 12.1893 11.395 12.3873 11.5029 12.6123C11.6107 12.8374 11.6667 13.0838 11.6667 13.3333C11.6662 13.6248 11.5889 13.911 11.4426 14.163C11.2963 14.4151 11.0862 14.6242 10.8334 14.7692Z" />
                                </svg>
                                Login
                            </Nav.Link>
                            <Nav.Link className="sign-up-link" variant="primary" href="/register">
                                Sign up
                            </Nav.Link>
                        </Nav>
                    )}
                    <div className="mobile-menu d-flex d-xl-none align-items-center">
                        {status === "authenticated" && (
                            <Nav className="navigation-authenticated me-3">
                                <NavDropdown id="user-dropdown" title={<img className="mobile-user-image" src={`/api/image/profilePicture?userId=${session.user.id}&provider=${session.user.provider}`} alt="profile picture" />} menuVariant="light" className="user-dropdown">
                                    <NavDropdown.Item href="/">Dashboard</NavDropdown.Item>
                                    <NavDropdown.Divider />
                                    <NavDropdown.Item onClick={() => signOut()}>Log out</NavDropdown.Item>
                                </NavDropdown>
                            </Nav>
                        )}
                        <div onClick={toggle} className="mobile-menu-trigger d-block d-xl-none">
                            <div className={buttonActive === true ? "hamburger is-active" : "hamburger"}>
                                <span className="line"></span>
                                <span className="line"></span>
                                <span className="line"></span>
                            </div>
                        </div>
                        <nav className={buttonActive === true ? "mobile-menu-navigation d-block d-xxl-none nav-open" : "mobile-menu-navigation d-block d-xxl-none"} id="navigation">
                            <div className="mobile-menu-inner">
                                <header>
                                    <p className="mt-0 pt-0">Navigation</p>
                                </header>
                                <Nav className="mobile-nav flex-column">
                                    <Link href="/" passHref>
                                        <Nav.Link eventKey="home">Home</Nav.Link>
                                    </Link>
                                    <Link href="/browse-images" passHref>
                                        <Nav.Link eventKey="images">Images</Nav.Link>
                                    </Link>
                                    <Link href="/pricing" passHref>
                                        <Nav.Link eventKey="pricing">Pricing</Nav.Link>
                                    </Link>
                                    {status !== "authenticated" && (
                                        <div className="mobile-auth mt-5 mb-5">
                                            <div className="mobile-auth-actions">
                                                <Nav.Link className="mobile-login mb-3 mb-sm-0" href="/login">
                                                    Login
                                                    <svg width="18" height="18" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                                                        <path
                                                            d="M10 1.66667C7.70254 1.66667 5.83337 3.53584 5.83337 5.83334V8.33334H5.00004C4.55801 8.33334 4.13409 8.50893 3.82153 8.82149C3.50897 9.13406 3.33337 9.55798 3.33337 10V16.6667C3.33337 17.1087 3.50897 17.5326 3.82153 17.8452C4.13409 18.1577 4.55801 18.3333 5.00004 18.3333H15C15.4421 18.3333 15.866 18.1577 16.1786 17.8452C16.4911 17.5326 16.6667 17.1087 16.6667 16.6667V10C16.6667 9.55798 16.4911 9.13406 16.1786 8.82149C15.866 8.50893 15.4421 8.33334 15 8.33334H14.1667V5.83334C14.1667 3.53584 12.2975 1.66667 10 1.66667ZM7.50004 5.83334C7.50004 4.45501 8.62171 3.33334 10 3.33334C11.3784 3.33334 12.5 4.45501 12.5 5.83334V8.33334H7.50004V5.83334ZM10.8334 14.7692V16.6667H9.16671V14.7692C8.87536 14.6023 8.64142 14.3511 8.49573 14.0486C8.35004 13.7462 8.29944 13.4066 8.35061 13.0748C8.40178 12.743 8.5523 12.4345 8.78234 12.1899C9.01238 11.9454 9.31114 11.7763 9.63921 11.705C9.88289 11.6511 10.1356 11.6526 10.3786 11.7094C10.6216 11.7662 10.8488 11.8768 11.0434 12.0331C11.2379 12.1893 11.395 12.3873 11.5029 12.6123C11.6107 12.8374 11.6667 13.0838 11.6667 13.3333C11.6662 13.6248 11.5889 13.911 11.4426 14.163C11.2963 14.4151 11.0862 14.6242 10.8334 14.7692Z"
                                                            fill="white"
                                                        />
                                                    </svg>
                                                </Nav.Link>
                                                <Nav.Link className="mobile-sign-up" variant="primary" href="/register">
                                                    Sign up
                                                </Nav.Link>
                                            </div>
                                        </div>
                                    )}
                                </Nav>
                            </div>
                        </nav>
                    </div>
                </Container>
            </Navbar>
        </div>
    )
}
